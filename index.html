<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 é¦¬å¹´é™¤å¤•æŠ½ç</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --red: #d32f2f; --gold: #ffd700; --dark-red: #8b0000; }
        body { margin: 0; background-color: var(--dark-red); font-family: "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: var(--gold); padding: 40px 20px; overflow-x: hidden; }
        h1 { font-size: 3rem; text-shadow: 3px 3px 6px rgba(0,0,0,0.5); }
        .main-stage { text-align: center; background: var(--red); border: 12px solid var(--gold); border-radius: 30px; padding: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.6); width: 100%; max-width: 700px; margin-bottom: 30px; position: relative; z-index: 10; }
        .display-box { background: white; color: var(--red); font-size: 4rem; font-weight: bold; height: 180px; display: flex; align-items: center; justify-content: center; border-radius: 20px; margin: 20px 0; border: 6px inset var(--gold); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }
        .btn { background: linear-gradient(180deg, #ffd700 0%, #ff9900 100%); color: var(--dark-red); border: none; padding: 25px 0; width: 100%; font-size: 2.2rem; font-weight: bold; border-radius: 60px; cursor: pointer; box-shadow: 0 10px 0 #b8860b; transition: 0.1s; }
        .btn:active { transform: translateY(5px); box-shadow: 0 5px 0 #b8860b; }
        .btn:disabled { background: #999; box-shadow: none; color: #444; transform: none; }
        select { width: 80%; padding: 15px; font-size: 1.5rem; border-radius: 15px; border: 4px solid var(--gold); margin-bottom: 20px; }
        
        .dashboard { width: 100%; max-width: 800px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: rgba(0, 0, 0, 0.3); border: 2px solid var(--gold); border-radius: 15px; padding: 20px; display: flex; flex-direction: column; }
        .card h4 { margin-top: 0; border-bottom: 1px solid rgba(255, 215, 0, 0.3); padding-bottom: 10px; }
        
        /* --- ä¿®æ”¹ 1: æ²è»¸æ§åˆ¶å€ (Scroll Box) --- */
        .scroll-box {
            max-height: 200px; /* å›ºå®šé«˜åº¦ */
            overflow-y: auto;  /* è¶…å‡ºæ™‚é¡¯ç¤ºå‚ç›´æ²è»¸ */
            padding-right: 5px;
        }
        /* è‡ªè¨‚æ²è»¸æ¨£å¼ (Chrome/Safari) */
        .scroll-box::-webkit-scrollbar { width: 8px; }
        .scroll-box::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 4px; }
        .scroll-box::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 4px; }
        /* -------------------------------------- */

        table { width: 100%; font-size: 1.2rem; color: #fff; border-collapse: collapse; }
        td { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        .reset-link { margin-top: 50px; color: rgba(255,255,255,0.2); font-size: 0.8rem; cursor: pointer; }

        /* --- ä¿®æ”¹ 2: é‡‘è‰²é–ƒå…‰ç‰¹æ•ˆ (Flash Layer) --- */
        #flash-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white; /* åˆå§‹é–ƒå…‰æ˜¯ç™½/é‡‘ */
            opacity: 0;
            pointer-events: none;
            z-index: 10000; /* æ¯”å¤§çåœ–å±¤æ›´é«˜ä¸€é» */
            display: none;
        }
        .flash-anim {
            display: block !important;
            animation: flashBang 0.8s ease-out forwards;
        }
        @keyframes flashBang {
            0% { opacity: 0; background: #fff; }
            10% { opacity: 1; background: #fff; } /* ç¬é–“å…¨ç™½ */
            30% { opacity: 0.8; background: #ffd700; } /* è½‰ç‚ºé‡‘è‰² */
            100% { opacity: 0; }
        }
        /* --------------------------------------- */

        #big-win-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .sticker-container {
            text-align: center;
            animation: stickerPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .sticker-img {
            width: 80%;
            max-width: 400px;
            height: auto;
            filter: drop-shadow(0 0 30px gold);
            display: block;
            margin: 0 auto 20px auto;
        }

        .sticker-text {
            font-size: 4rem;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
            margin: 0;
            background: linear-gradient(to right, #ffd700, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sticker-subtext {
            font-size: 2.5rem;
            color: white;
            margin-top: 10px;
        }

        @keyframes stickerPop {
            0% { transform: scale(0) rotate(-15deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            70% { transform: scale(0.9) rotate(-3deg); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        .sunburst {
            position: absolute;
            top: 50%; left: 50%;
            width: 200vmax; height: 200vmax;
            background: repeating-conic-gradient(from 0deg, rgba(255, 215, 0, 0.1) 0deg 10deg, transparent 10deg 20deg);
            transform: translate(-50%, -50%);
            animation: rotateBurst 10s linear infinite;
            z-index: -1;
        }
        @keyframes rotateBurst { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
    </style>
</head>
<body>

    <div id="flash-layer"></div>

    <audio id="snd-spin" src="mixkit-children-happy-countdown-923.wav" preload="auto"></audio>
    <audio id="snd-win" src="mixkit-final-level-bonus-2061.wav" preload="auto"></audio>
    <audio id="snd-bigwin" src="mixkit-medieval-show-fanfare-announcement-226.wav" preload="auto"></audio>

    <div id="big-win-overlay" onclick="closeOverlay()">
        <div class="sunburst"></div>
        <div class="sticker-container">
            <img src="bingo.png" alt="Bingo å¤§ç" class="sticker-img">
            
            <div class="sticker-text">æ­å–œç™¼è²¡ï¼</div>
            <div class="sticker-subtext" id="overlay-prize-name">ç²å¾—å¤§ç</div>
        </div>
        <div style="margin-top: 50px; color: #aaa; font-size: 1rem;">(é»æ“Šç•«é¢é—œé–‰)</div>
    </div>

    <h1>ğŸ 2026 é¾é¦¬ç²¾ç¥ Â· é™¤å¤•å¤§æŠ½ç ğŸ§§</h1>

    <div class="main-stage">
        <select id="user-select">
            <option value="">-- è«‹å…ˆé»æ“Šé¸æ“‡æˆå“¡ --</option>
            <option value="A">æˆå“¡ A (å¤§ç $2200)</option>
            <option value="B">æˆå“¡ B (å¤§ç $6000)</option>
            <option value="C">æˆå“¡ C (å¤§ç $3600)</option>
        </select>

        <div class="display-box" id="result-display">æº–å‚™é–‹ç...</div>
        <button class="btn" id="spin-btn">é–‹ å§‹ æŠ½ ç</button>
        <div id="message" style="font-size: 1.8rem; margin-top: 25px; color: white;"></div>
    </div>

    <div class="dashboard">
        <div class="card">
            <h4>ğŸ“¦ å…¬å…±æ± å‰©é¤˜</h4>
            <div id="pool-list" class="scroll-box" style="font-size: 1.1rem; line-height: 1.8;"></div>
        </div>
        <div class="card">
            <h4>ğŸ“œ ä¸­çå¥½é‹æ¦œ</h4>
            <div class="scroll-box">
                <table id="record-table"><tbody id="record-body"></tbody></table>
            </div>
        </div>
    </div>

    <div class="reset-link" onclick="resetGame()">é‡ç½®ç³»çµ±é€²åº¦</div>

    <script>
        const DEFAULT_POOL = ["ç´…åŒ… 600å…ƒ", "ç´…åŒ… 600å…ƒ", "ç´…åŒ… 888å…ƒ", "ç´…åŒ… 888å…ƒ", "åˆ®åˆ®æ¨‚ 100å…ƒ", "è¶…å•†ç¦®åˆ¸ 500å…ƒ", "ç²¾ç¾å°ç¦®ç‰©"];
        const DEFAULT_PERSONAL = {
            "A": { name: "æˆå“¡ A", prize: "å¤§ç 2200å…ƒ", won: false },
            "B": { name: "æˆå“¡ B", prize: "å¤§ç 6000å…ƒ", won: false },
            "C": { name: "æˆå“¡ C", prize: "å¤§ç 3600å…ƒ", won: false }
        };

        let publicPool, personalPrizes, records;

        function loadData() {
            // ç¶­æŒä½¿ç”¨ v4 key
            publicPool = JSON.parse(localStorage.getItem('cny2026_v4_pool')) || [...DEFAULT_POOL];
            personalPrizes = JSON.parse(localStorage.getItem('cny2026_v4_personal')) || JSON.parse(JSON.stringify(DEFAULT_PERSONAL));
            records = JSON.parse(localStorage.getItem('cny2026_v4_records')) || [];
            updateUI();
        }

        const btn = document.getElementById('spin-btn');
        const display = document.getElementById('result-display');
        const userSelect = document.getElementById('user-select');
        const message = document.getElementById('message');
        const overlay = document.getElementById('big-win-overlay');
        const overlayText = document.getElementById('overlay-prize-name');
        
        const sndSpin = document.getElementById('snd-spin');
        const sndWin = document.getElementById('snd-win');
        const sndBigWin = document.getElementById('snd-bigwin');
        const flashLayer = document.getElementById('flash-layer'); // å–å¾—é–ƒå…‰å±¤

        btn.addEventListener('click', () => {
            const userKey = userSelect.value;
            if(!userKey) { alert("è«‹å…ˆé¸æ“‡æˆå“¡ï¼"); return; }

            const pData = personalPrizes[userKey];
            let currentPool = [...publicPool];
            if(!pData.won) currentPool.push(pData.prize);

            if(currentPool.length === 0) { message.innerText = "å…¨éƒ¨æŠ½å®Œäº†ï¼å¤§å®¶é¦¬å¹´ç™¼è²¡ï¼"; return; }

            btn.disabled = true;
            userSelect.disabled = true;
            message.innerText = "å¥½é‹å¥”é¨°ä¸­...";
            
            sndSpin.currentTime = 0;
            sndSpin.loop = true;
            sndSpin.play();

            let count = 0;
            const timer = setInterval(() => {
                display.innerText = currentPool[Math.floor(Math.random() * currentPool.length)];
                count += 60;
                
                if(count >= 3000) { 
                    clearInterval(timer);
                    sndSpin.pause(); 

                    const finalPrize = currentPool[Math.floor(Math.random() * currentPool.length)];
                    
                    if(finalPrize === pData.prize) {
                        pData.won = true;
                        
                        // --- è§¸ç™¼é–ƒå…‰èˆ‡å¤§ç ---
                        triggerFlash(); 
                        sndBigWin.play();
                        showBigWinAnimation(pData.name, finalPrize);
                        
                        message.innerHTML = `ğŸŠ ç‹‚è³€ï¼${pData.name} å¥ªå¾—å¤§ç <b>${finalPrize}</b>ï¼`;
                    } else {
                        const idx = publicPool.indexOf(finalPrize);
                        if(idx > -1) publicPool.splice(idx, 1);
                        sndWin.play();
                        triggerConfetti();
                        message.innerText = `æ­å–œç²å¾—ï¼š${finalPrize}`;
                    }
                    
                    display.innerText = finalPrize;
                    records.unshift({ name: pData.name, prize: finalPrize });
                    saveData();
                    updateUI();
                    
                    if(finalPrize !== pData.prize) {
                        btn.disabled = false;
                        userSelect.disabled = false;
                    }
                }
            }, 60);
        });

        function triggerConfetti() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ffd700', '#ff0000', '#ffffff'] });
        }

        // æ–°å¢é–ƒå…‰è§¸ç™¼å‡½å¼
        function triggerFlash() {
            flashLayer.classList.remove('flash-anim');
            void flashLayer.offsetWidth; // å¼·åˆ¶é‡ç¹ª
            flashLayer.classList.add('flash-anim');
        }

        function showBigWinAnimation(name, prize) {
            overlayText.innerText = `${name} ç¨å¾— ${prize}`;
            overlay.style.display = 'flex';
            setTimeout(() => { closeOverlay(); }, 6000); // ç¶­æŒ 6 ç§’
        }

        function closeOverlay() {
            overlay.style.display = 'none';
            btn.disabled = false;
            userSelect.disabled = false;
        }

        function updateUI() {
            const counts = {};
            publicPool.forEach(x => counts[x] = (counts[x] || 0) + 1);
            document.getElementById('pool-list').innerHTML = Object.entries(counts).map(([k,v]) => `â€¢ ${k} x${v}`).join('<br>');
            document.getElementById('record-body').innerHTML = records.map(r => `<tr><td>${r.name}</td><td>${r.prize}</td></tr>`).join('');
        }

        function saveData() {
            localStorage.setItem('cny2026_v4_pool', JSON.stringify(publicPool));
            localStorage.setItem('cny2026_v4_personal', JSON.stringify(personalPrizes));
            localStorage.setItem('cny2026_v4_records', JSON.stringify(records));
        }

        function resetGame() { if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) { localStorage.clear(); location.reload(); } }

        loadData();
    </script>
</body>

</html>
