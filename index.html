<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 é¦¬å¹´ç™¼è²¡é‡‘ - ç‰¹æ•ˆå¼·åŒ–ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --red: #d32f2f; --gold: #ffd700; --dark-red: #8b0000; --panel-bg: rgba(0,0,0,0.4); }
        
        body { 
            margin: 0; 
            background-color: var(--dark-red); 
            font-family: "Microsoft JhengHei", sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            color: var(--gold); 
            padding: 20px; 
            box-sizing: border-box;
        }

        h1 { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin: 0 0 20px 0; }
        
        .main-stage {
            background: var(--red);
            border: 6px solid var(--gold);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden; /* è®“é–ƒå…‰ç‰¹æ•ˆé™åˆ¶åœ¨æ¡†å…§ */
        }

        .user-info {
            background: rgba(255,255,255,0.15);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: none;
        }

        .display-box {
            background: white;
            color: var(--red);
            font-size: 3rem;
            font-weight: bold;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            margin: 20px 0;
            border: 5px inset var(--gold);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
            padding: 0 10px;
            position: relative;
            z-index: 2;
        }

        select { padding: 12px; font-size: 1.3rem; border-radius: 10px; border: 3px solid var(--gold); width: 100%; text-align: center; cursor: pointer; }
        
        .btn {
            background: linear-gradient(180deg, #ffd700 0%, #ff9900 100%);
            color: var(--dark-red);
            border: none;
            padding: 18px;
            font-size: 2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #b8860b;
            width: 100%;
            transition: 0.1s;
            position: relative;
            z-index: 2;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #b8860b; }
        .btn:disabled { background: #ccc; box-shadow: none; color: #666; cursor: not-allowed; }

        .status-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 1000px;
        }

        .pool-column {
            background: var(--panel-bg);
            border: 1px solid var(--gold);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: left;
            min-height: 200px;
        }

        .pool-column h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,215,0,0.4);
            padding-bottom: 8px;
            color: #fff;
        }

        .highlight-item { color: #ffeb3b; font-weight: bold; text-shadow: 0 0 2px #b8860b; }

        .history-section {
            width: 100%;
            max-width: 1000px;
            margin-top: 20px;
            background: var(--panel-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 150px;
            overflow-y: auto;
            color: white;
            font-size: 1rem;
        }

        .history-list li {
            padding: 5px 0;
            border-bottom: 1px dashed rgba(255,255,255,0.2);
            display: flex;
            justify-content: space-between;
        }

        .reset-link { margin-top: 40px; color: rgba(255,255,255,0.3); font-size: 0.8rem; cursor: pointer; text-decoration: underline; }

        /* é–ƒçˆå‹•ç•«ç‰¹æ•ˆ */
        @keyframes flash-gold {
            0% { background-color: var(--red); }
            50% { background-color: #ffeb3b; }
            100% { background-color: var(--red); }
        }
        @keyframes flash-white {
            0% { background-color: var(--red); }
            50% { background-color: #ffffff; }
            100% { background-color: var(--red); }
        }
        .anim-gold { animation: flash-gold 0.5s ease-out 3; } /* å¤§çé–ƒé‡‘å…‰ */
        .anim-white { animation: flash-white 0.2s ease-out 2; } /* å°çé–ƒç™½å…‰ */

        @media (max-width: 800px) { .status-board { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <audio id="snd-spin" src="mixkit-children-happy-countdown-923.wav" preload="auto"></audio>
    <audio id="snd-win" src="mixkit-final-level-bonus-2061.wav" preload="auto"></audio>
    <audio id="snd-bigwin" src="mixkit-medieval-show-fanfare-announcement-226.wav" preload="auto"></audio>

    <h1>ğŸ 2026 é¦¬å¹´å–œæ°£æŠ½ ğŸ§§</h1>

    <div class="main-stage" id="main-stage">
        <select id="user-select" onchange="switchUser()">
            <option value="">-- è«‹é¸æ“‡æŠ½çäºº --</option>
            <option value="mom">åª½åª½</option>
            <option value="sis1">å¤§å§</option>
            <option value="sis2">äºŒå§</option>
        </select>

        <div id="user-info-display" class="user-info">
            å·²æŠ½æ¬¡æ•¸ï¼š<span id="draw-count" style="font-weight:bold; color:#fff; font-size:1.5rem;">0</span> æ¬¡
        </div>

        <div class="display-box" id="result-display">æº–å‚™é–‹å§‹</div>
        <button class="btn" id="spin-btn">é–‹ å§‹ æŠ½ ç</button>
        <div id="message" style="margin-top: 15px; min-height: 1.5em; color: white; font-size: 1.2rem;"></div>
    </div>

    <div class="status-board">
        <div class="pool-column" style="border-color: #ff80ab;">
            <h3>ğŸ‘© åª½åª½çš„å‰©é¤˜çé …</h3>
            <div id="mom-list" style="font-size:0.9rem; line-height:1.6; color:#ddd;"></div>
        </div>
        <div class="pool-column" style="border-color: #ea80fc;">
            <h3>ğŸ‘§ å¤§å§çš„å‰©é¤˜çé …</h3>
            <div id="sis1-list" style="font-size:0.9rem; line-height:1.6; color:#ddd;"></div>
        </div>
        <div class="pool-column" style="border-color: #ce93d8;">
            <h3>ğŸ‘§ äºŒå§çš„å‰©é¤˜çé …</h3>
            <div id="sis2-list" style="font-size:0.9rem; line-height:1.6; color:#ddd;"></div>
        </div>
    </div>

    <div class="history-section">
        <h3 style="margin:0 0 10px 0; border-bottom:1px solid gold; padding-bottom:5px;">ğŸ“œ ä¸­çç´€éŒ„ä¸€è¦½</h3>
        <ul id="history-list" class="history-list"><li style="color:#aaa;">ç›®å‰å°šç„¡ç´€éŒ„</li></ul>
    </div>

    <div class="reset-link" onclick="resetSystem()">é‡ç½®ç³»çµ± (æ¸…é™¤æ‰€æœ‰é€²åº¦)</div>

    <script>
        // --- 1. çæ± è¨­å®š ---
        const COMMON_TEMPLATE = [
            "ç´…åŒ…F1", "ç´…åŒ…F2", 
            "ç´…åŒ…E1", "ç´…åŒ…E2", "ç´…åŒ…E3", "ç´…åŒ…E4", "ç´…åŒ…E5", "ç´…åŒ…E6", 
            "ç´…åŒ…D1", 
            "ç´…åŒ…C1", "ç´…åŒ…C2", 
            "ç´…åŒ… 1000"
        ];
        const MOM_SPECIAL = ["ç¾é‡‘ $2400", "ç¾é‡‘ $2400", "ç¾é‡‘ $2400", "ç¾é‡‘ $1000", "ç¾é‡‘ $1000"];
        const SIS_SPECIAL = ["ç¾é‡‘ $1200", "ç¾é‡‘ $800", "ç¾é‡‘ $600"];
        
        // --- 2. ç³»çµ±è®Šæ•¸ ---
        let userPools = {}, drawCounts = {}, records = [];
        
        const sndSpin = document.getElementById('snd-spin');
        const sndWin = document.getElementById('snd-win');
        const sndBigWin = document.getElementById('snd-bigwin');
        const mainStage = document.getElementById('main-stage');

        // --- 3. åˆå§‹åŒ– ---
        function init() {
            const savedUsers = localStorage.getItem('cny26_v8_users');
            if (savedUsers) {
                userPools = JSON.parse(savedUsers);
                drawCounts = JSON.parse(localStorage.getItem('cny26_v8_counts'));
                records = JSON.parse(localStorage.getItem('cny26_v8_records')) || [];
            } else {
                userPools = {
                    "mom": [...MOM_SPECIAL, ...COMMON_TEMPLATE],
                    "sis1": [...SIS_SPECIAL, ...COMMON_TEMPLATE],
                    "sis2": [...SIS_SPECIAL, ...COMMON_TEMPLATE]
                };
                drawCounts = { "mom": 0, "sis1": 0, "sis2": 0 };
                records = [];
            }
            updateUI();
        }

        function save() {
            localStorage.setItem('cny26_v8_users', JSON.stringify(userPools));
            localStorage.setItem('cny26_v8_counts', JSON.stringify(drawCounts));
            localStorage.setItem('cny26_v8_records', JSON.stringify(records));
        }

        // --- 4. ä»‹é¢é‚è¼¯ ---
        const userSelect = document.getElementById('user-select');
        const countDisplay = document.getElementById('draw-count');
        const infoDiv = document.getElementById('user-info-display');
        const btn = document.getElementById('spin-btn');
        const display = document.getElementById('result-display');
        const msg = document.getElementById('message');

        function switchUser() {
            const user = userSelect.value;
            if (!user) { infoDiv.style.display = 'none'; return; }
            infoDiv.style.display = 'block';
            countDisplay.innerText = drawCounts[user];
            msg.innerText = "";
            display.innerText = "æº–å‚™å¥½";
        }

        function renderPoolList(elementId, items) {
            const el = document.getElementById(elementId);
            if (!items || items.length === 0) {
                el.innerHTML = "<span style='color:#666'>æ­¤äººçæ± å·²ç©º</span>";
                return;
            }
            const counts = {};
            items.forEach(x => counts[x] = (counts[x] || 0) + 1);
            
            el.innerHTML = Object.entries(counts).map(([k,v]) => {
                // å˜—è©¦è§£ææ•¸å­— (æ”¯æ´ "ç´…åŒ…F1" é€™é¡æ–‡å­—)
                const val = parseInt(k.replace(/[^0-9]/g, '')) || 0;
                const style = val >= 1000 ? "class='highlight-item'" : "";
                return `<div ${style}>â€¢ ${k} x${v}</div>`;
            }).join('');
        }

        function updateUI() {
            renderPoolList('mom-list', userPools['mom']);
            renderPoolList('sis1-list', userPools['sis1']);
            renderPoolList('sis2-list', userPools['sis2']);
            
            const historyList = document.getElementById('history-list');
            if(records.length > 0) {
                historyList.innerHTML = records.map(r => `
                    <li>
                        <span style="color:var(--gold); font-weight:bold;">${r.who}</span>
                        <span>${r.prize}</span>
                    </li>
                `).join('');
            } else {
                historyList.innerHTML = "<li style='color:#aaa;'>ç›®å‰å°šç„¡ç´€éŒ„</li>";
            }
        }

        // --- 5. ç‰¹æ•ˆå‡½æ•¸ ---
        function triggerWinEffect(isBig) {
            if (isBig) {
                // å¤§çç‰¹æ•ˆï¼šå¤§é‡é‡‘ç´…ç¢ç´™èŠ± + 3ç§’ç…™ç«
                const duration = 3000;
                const end = Date.now() + duration;
                (function frame() {
                    confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ffd700', '#ff0000'] });
                    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ffd700', '#ff0000'] });
                    if (Date.now() < end) requestAnimationFrame(frame);
                }());
                // é–ƒçˆèƒŒæ™¯ (é‡‘å…‰)
                mainStage.classList.remove('anim-white');
                mainStage.classList.add('anim-gold');
                setTimeout(() => mainStage.classList.remove('anim-gold'), 1500);
            } else {
                // å°çç‰¹æ•ˆï¼šå°çˆ†ç‚¸ (ç™½è‰²+é‡‘è‰²)
                confetti({
                    particleCount: 80,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ffffff', '#ffd700'],
                    gravity: 1.2
                });
                // é–ƒçˆèƒŒæ™¯ (ç™½å…‰)
                mainStage.classList.remove('anim-gold');
                mainStage.classList.add('anim-white');
                setTimeout(() => mainStage.classList.remove('anim-white'), 500);
            }
        }

        // --- 6. æŠ½çæ ¸å¿ƒ ---
        btn.addEventListener('click', () => {
            const user = userSelect.value;
            if (!user) { alert("è«‹å…ˆé¸æ“‡æŠ½çäººï¼"); return; }
            
            let currentPool = userPools[user];
            if (currentPool.length === 0) { 
                msg.innerText = "è©²æˆå“¡çš„çæ± å·²ç¶“å…¨éƒ¨æŠ½å®Œå›‰ï¼"; 
                return; 
            }

            // éŸ³æ•ˆé è¼‰ (ç¢ºä¿é»æ“Šæ™‚è§¸ç™¼ç€è¦½å™¨æˆæ¬Š)
            sndSpin.load(); sndWin.load(); sndBigWin.load();

            btn.disabled = true;
            userSelect.disabled = true;
            msg.innerText = "å¥½é‹é‹ç®—ä¸­...";
            
            sndSpin.currentTime = 0;
            sndSpin.loop = true;
            sndSpin.volume = 0.5;
            sndSpin.play().catch(()=>{});

            let count = 0;
            const timer = setInterval(() => {
                display.innerText = currentPool[Math.floor(Math.random() * currentPool.length)];
                count += 60;

                if (count >= 2000) {
                    clearInterval(timer);
                    sndSpin.pause();

                    // 1. æ±ºå®šä¸­ç
                    const winIndex = Math.floor(Math.random() * currentPool.length);
                    const winItem = currentPool[winIndex];

                    // 2. ç§»é™¤çé …
                    userPools[user].splice(winIndex, 1);
                    drawCounts[user]++;

                    // 3. åˆ¤æ–·å¤§å°ç (è¶…é 1000 ç®—å¤§ç)
                    const val = parseInt(winItem.replace(/[^0-9]/g, '')) || 0;
                    const isBigWin = val >= 1000;

                    if (isBigWin) {
                        sndBigWin.currentTime = 0;
                        sndBigWin.play();
                        triggerWinEffect(true); // å¤§çç‰¹æ•ˆ
                        msg.innerHTML = `ğŸ‰ æ­å–œæŠ½ä¸­å¤§ç <b style="color:#ffeb3b; font-size:1.5rem;">${winItem}</b>ï¼`;
                    } else {
                        sndWin.currentTime = 0;
                        sndWin.play();
                        triggerWinEffect(false); // å°çç‰¹æ•ˆ
                        msg.innerText = `æ­å–œç²å¾—ï¼š${winItem}`;
                    }

                    display.innerText = winItem;
                    
                    let userName = user;
                    if(user === "mom") userName = "åª½åª½";
                    if(user === "sis1") userName = "å¤§å§";
                    if(user === "sis2") userName = "äºŒå§";

                    records.unshift({ who: userName, prize: winItem });
                    
                    save();
                    updateUI();
                    
                    btn.disabled = false;
                    userSelect.disabled = false;
                    countDisplay.innerText = drawCounts[user];
                }
            }, 60);
        });

        function resetSystem() { if(confirm("ç¢ºå®šé‡ç½®æ‰€æœ‰è³‡æ–™ï¼Ÿ")) { localStorage.clear(); location.reload(); } }

        init();
    </script>
</body>
</html>